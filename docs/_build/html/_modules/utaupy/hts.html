<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-3.5.1, furo 2021.02.28.beta28"/>
        <title>utaupy.hts - utaupy documentation</title>
      <link rel="stylesheet" href="../../_static/styles/furo.css?digest=be5985a4059b5c2cd56ed0804790452beca62674">
    <link rel="stylesheet" href="../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" href="../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">utaupy  documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">utaupy  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../utaupy.html">utaupy package</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../utaupy.utils.html">utaupy.utils package</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <h1>Source code for utaupy.hts</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># Copyright (c) 2020 oatsu</span>
<span class="sd">"""Python3 module for HTS-full-label.</span>

<span class="sd">Sinsy仕様のHTSフルコンテキストラベルを扱うモジュール</span>
<span class="sd">forループが多いのでpypy3を使っても良いかも。(とくにdeepcopyが重い)</span>
<span class="sd">"""</span>
<span class="c1"># import json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserList</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">ROUND_HALF_UP</span><span class="p">,</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">label</span> <span class="k">as</span> <span class="n">_label</span>

<span class="c1"># from pprint import pprint</span>

<span class="c1"># p1を埋めるのに使う。</span>
<span class="n">VOWELS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'u'</span><span class="p">,</span> <span class="s1">'e'</span><span class="p">,</span> <span class="s1">'o'</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">,</span> <span class="s1">'I'</span><span class="p">,</span> <span class="s1">'U'</span><span class="p">,</span> <span class="s1">'E'</span><span class="p">,</span> <span class="s1">'O'</span><span class="p">,</span> <span class="s1">'N'</span><span class="p">,</span> <span class="s1">'ae'</span><span class="p">,</span> <span class="s1">'AE'</span><span class="p">]</span>
<span class="n">BREAKS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'br'</span><span class="p">,</span> <span class="s1">'cl'</span><span class="p">]</span>
<span class="n">PAUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'pau'</span><span class="p">]</span>
<span class="n">SILENCES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sil'</span><span class="p">]</span>

<span class="c1"># e1を埋めるのに使う</span>
<span class="n">NOTENUM_TO_ABSPITCH_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'xx'</span><span class="p">:</span> <span class="s1">'xx'</span><span class="p">,</span>
    <span class="s1">'12'</span><span class="p">:</span> <span class="s1">'C0'</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">:</span> <span class="s1">'Db0'</span><span class="p">,</span> <span class="s1">'14'</span><span class="p">:</span> <span class="s1">'D0'</span><span class="p">,</span> <span class="s1">'15'</span><span class="p">:</span> <span class="s1">'Eb0'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">:</span> <span class="s1">'E0'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">:</span> <span class="s1">'F0'</span><span class="p">,</span>
    <span class="s1">'18'</span><span class="p">:</span> <span class="s1">'Gb0'</span><span class="p">,</span> <span class="s1">'19'</span><span class="p">:</span> <span class="s1">'G0'</span><span class="p">,</span> <span class="s1">'20'</span><span class="p">:</span> <span class="s1">'Ab0'</span><span class="p">,</span> <span class="s1">'21'</span><span class="p">:</span> <span class="s1">'A0'</span><span class="p">,</span> <span class="s1">'22'</span><span class="p">:</span> <span class="s1">'Bb0'</span><span class="p">,</span> <span class="s1">'23'</span><span class="p">:</span> <span class="s1">'B0'</span><span class="p">,</span>
    <span class="s1">'24'</span><span class="p">:</span> <span class="s1">'C1'</span><span class="p">,</span> <span class="s1">'25'</span><span class="p">:</span> <span class="s1">'Db1'</span><span class="p">,</span> <span class="s1">'26'</span><span class="p">:</span> <span class="s1">'D1'</span><span class="p">,</span> <span class="s1">'27'</span><span class="p">:</span> <span class="s1">'Eb1'</span><span class="p">,</span> <span class="s1">'28'</span><span class="p">:</span> <span class="s1">'E1'</span><span class="p">,</span> <span class="s1">'29'</span><span class="p">:</span> <span class="s1">'F1'</span><span class="p">,</span>
    <span class="s1">'30'</span><span class="p">:</span> <span class="s1">'Gb1'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">:</span> <span class="s1">'G1'</span><span class="p">,</span> <span class="s1">'32'</span><span class="p">:</span> <span class="s1">'Ab1'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">:</span> <span class="s1">'A1'</span><span class="p">,</span> <span class="s1">'34'</span><span class="p">:</span> <span class="s1">'Bb1'</span><span class="p">,</span> <span class="s1">'35'</span><span class="p">:</span> <span class="s1">'B1'</span><span class="p">,</span>
    <span class="s1">'36'</span><span class="p">:</span> <span class="s1">'C2'</span><span class="p">,</span> <span class="s1">'37'</span><span class="p">:</span> <span class="s1">'Db2'</span><span class="p">,</span> <span class="s1">'38'</span><span class="p">:</span> <span class="s1">'D2'</span><span class="p">,</span> <span class="s1">'39'</span><span class="p">:</span> <span class="s1">'Eb2'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">:</span> <span class="s1">'E2'</span><span class="p">,</span> <span class="s1">'41'</span><span class="p">:</span> <span class="s1">'F2'</span><span class="p">,</span>
    <span class="s1">'42'</span><span class="p">:</span> <span class="s1">'Gb2'</span><span class="p">,</span> <span class="s1">'43'</span><span class="p">:</span> <span class="s1">'G2'</span><span class="p">,</span> <span class="s1">'44'</span><span class="p">:</span> <span class="s1">'Ab2'</span><span class="p">,</span> <span class="s1">'45'</span><span class="p">:</span> <span class="s1">'A2'</span><span class="p">,</span> <span class="s1">'46'</span><span class="p">:</span> <span class="s1">'Bb2'</span><span class="p">,</span> <span class="s1">'47'</span><span class="p">:</span> <span class="s1">'B2'</span><span class="p">,</span>
    <span class="s1">'48'</span><span class="p">:</span> <span class="s1">'C3'</span><span class="p">,</span> <span class="s1">'49'</span><span class="p">:</span> <span class="s1">'Db3'</span><span class="p">,</span> <span class="s1">'50'</span><span class="p">:</span> <span class="s1">'D3'</span><span class="p">,</span> <span class="s1">'51'</span><span class="p">:</span> <span class="s1">'Eb3'</span><span class="p">,</span> <span class="s1">'52'</span><span class="p">:</span> <span class="s1">'E3'</span><span class="p">,</span> <span class="s1">'53'</span><span class="p">:</span> <span class="s1">'F3'</span><span class="p">,</span>
    <span class="s1">'54'</span><span class="p">:</span> <span class="s1">'Gb3'</span><span class="p">,</span> <span class="s1">'55'</span><span class="p">:</span> <span class="s1">'G3'</span><span class="p">,</span> <span class="s1">'56'</span><span class="p">:</span> <span class="s1">'Ab3'</span><span class="p">,</span> <span class="s1">'57'</span><span class="p">:</span> <span class="s1">'A3'</span><span class="p">,</span> <span class="s1">'58'</span><span class="p">:</span> <span class="s1">'Bb3'</span><span class="p">,</span> <span class="s1">'59'</span><span class="p">:</span> <span class="s1">'B3'</span><span class="p">,</span>
    <span class="s1">'60'</span><span class="p">:</span> <span class="s1">'C4'</span><span class="p">,</span> <span class="s1">'61'</span><span class="p">:</span> <span class="s1">'Db4'</span><span class="p">,</span> <span class="s1">'62'</span><span class="p">:</span> <span class="s1">'D4'</span><span class="p">,</span> <span class="s1">'63'</span><span class="p">:</span> <span class="s1">'Eb4'</span><span class="p">,</span> <span class="s1">'64'</span><span class="p">:</span> <span class="s1">'E4'</span><span class="p">,</span> <span class="s1">'65'</span><span class="p">:</span> <span class="s1">'F4'</span><span class="p">,</span>
    <span class="s1">'66'</span><span class="p">:</span> <span class="s1">'Gb4'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">:</span> <span class="s1">'G4'</span><span class="p">,</span> <span class="s1">'68'</span><span class="p">:</span> <span class="s1">'Ab4'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">:</span> <span class="s1">'A4'</span><span class="p">,</span> <span class="s1">'70'</span><span class="p">:</span> <span class="s1">'Bb4'</span><span class="p">,</span> <span class="s1">'71'</span><span class="p">:</span> <span class="s1">'B4'</span><span class="p">,</span>
    <span class="s1">'72'</span><span class="p">:</span> <span class="s1">'C5'</span><span class="p">,</span> <span class="s1">'73'</span><span class="p">:</span> <span class="s1">'Db5'</span><span class="p">,</span> <span class="s1">'74'</span><span class="p">:</span> <span class="s1">'D5'</span><span class="p">,</span> <span class="s1">'75'</span><span class="p">:</span> <span class="s1">'Eb5'</span><span class="p">,</span> <span class="s1">'76'</span><span class="p">:</span> <span class="s1">'E5'</span><span class="p">,</span> <span class="s1">'77'</span><span class="p">:</span> <span class="s1">'F5'</span><span class="p">,</span>
    <span class="s1">'78'</span><span class="p">:</span> <span class="s1">'Gb5'</span><span class="p">,</span> <span class="s1">'79'</span><span class="p">:</span> <span class="s1">'G5'</span><span class="p">,</span> <span class="s1">'80'</span><span class="p">:</span> <span class="s1">'Ab5'</span><span class="p">,</span> <span class="s1">'81'</span><span class="p">:</span> <span class="s1">'A5'</span><span class="p">,</span> <span class="s1">'82'</span><span class="p">:</span> <span class="s1">'Bb5'</span><span class="p">,</span> <span class="s1">'83'</span><span class="p">:</span> <span class="s1">'B5'</span><span class="p">,</span>
    <span class="s1">'84'</span><span class="p">:</span> <span class="s1">'C6'</span><span class="p">,</span> <span class="s1">'85'</span><span class="p">:</span> <span class="s1">'Db6'</span><span class="p">,</span> <span class="s1">'86'</span><span class="p">:</span> <span class="s1">'D6'</span><span class="p">,</span> <span class="s1">'87'</span><span class="p">:</span> <span class="s1">'Eb6'</span><span class="p">,</span> <span class="s1">'88'</span><span class="p">:</span> <span class="s1">'E6'</span><span class="p">,</span> <span class="s1">'89'</span><span class="p">:</span> <span class="s1">'F6'</span><span class="p">,</span>
    <span class="s1">'90'</span><span class="p">:</span> <span class="s1">'Gb6'</span><span class="p">,</span> <span class="s1">'91'</span><span class="p">:</span> <span class="s1">'G6'</span><span class="p">,</span> <span class="s1">'92'</span><span class="p">:</span> <span class="s1">'Ab6'</span><span class="p">,</span> <span class="s1">'93'</span><span class="p">:</span> <span class="s1">'A6'</span><span class="p">,</span> <span class="s1">'94'</span><span class="p">:</span> <span class="s1">'Bb6'</span><span class="p">,</span> <span class="s1">'95'</span><span class="p">:</span> <span class="s1">'B6'</span><span class="p">,</span>
    <span class="s1">'96'</span><span class="p">:</span> <span class="s1">'C7'</span><span class="p">,</span> <span class="s1">'97'</span><span class="p">:</span> <span class="s1">'Db7'</span><span class="p">,</span> <span class="s1">'98'</span><span class="p">:</span> <span class="s1">'D7'</span><span class="p">,</span> <span class="s1">'99'</span><span class="p">:</span> <span class="s1">'Eb7'</span><span class="p">,</span> <span class="s1">'100'</span><span class="p">:</span> <span class="s1">'E7'</span><span class="p">,</span> <span class="s1">'101'</span><span class="p">:</span> <span class="s1">'F7'</span><span class="p">,</span>
    <span class="s1">'102'</span><span class="p">:</span> <span class="s1">'Gb7'</span><span class="p">,</span> <span class="s1">'103'</span><span class="p">:</span> <span class="s1">'G7'</span><span class="p">,</span> <span class="s1">'104'</span><span class="p">:</span> <span class="s1">'Ab7'</span><span class="p">,</span> <span class="s1">'105'</span><span class="p">:</span> <span class="s1">'A7'</span><span class="p">,</span> <span class="s1">'106'</span><span class="p">:</span> <span class="s1">'Bb7'</span><span class="p">,</span> <span class="s1">'107'</span><span class="p">:</span> <span class="s1">'B7'</span><span class="p">,</span>
    <span class="s1">'108'</span><span class="p">:</span> <span class="s1">'C8'</span><span class="p">,</span> <span class="s1">'109'</span><span class="p">:</span> <span class="s1">'Db8'</span><span class="p">,</span> <span class="s1">'110'</span><span class="p">:</span> <span class="s1">'D8'</span><span class="p">,</span> <span class="s1">'111'</span><span class="p">:</span> <span class="s1">'Eb8'</span><span class="p">,</span> <span class="s1">'112'</span><span class="p">:</span> <span class="s1">'E8'</span><span class="p">,</span> <span class="s1">'113'</span><span class="p">:</span> <span class="s1">'F8'</span><span class="p">,</span>
    <span class="s1">'114'</span><span class="p">:</span> <span class="s1">'Gb8'</span><span class="p">,</span> <span class="s1">'115'</span><span class="p">:</span> <span class="s1">'G8'</span><span class="p">,</span> <span class="s1">'116'</span><span class="p">:</span> <span class="s1">'Ab8'</span><span class="p">,</span> <span class="s1">'117'</span><span class="p">:</span> <span class="s1">'A8'</span><span class="p">,</span> <span class="s1">'118'</span><span class="p">:</span> <span class="s1">'Bb8'</span><span class="p">,</span> <span class="s1">'119'</span><span class="p">:</span> <span class="s1">'B8'</span><span class="p">,</span>
    <span class="s1">'120'</span><span class="p">:</span> <span class="s1">'C9'</span><span class="p">,</span> <span class="s1">'121'</span><span class="p">:</span> <span class="s1">'Db9'</span><span class="p">,</span> <span class="s1">'122'</span><span class="p">:</span> <span class="s1">'D9'</span><span class="p">,</span> <span class="s1">'123'</span><span class="p">:</span> <span class="s1">'Eb9'</span><span class="p">,</span> <span class="s1">'124'</span><span class="p">:</span> <span class="s1">'E9'</span><span class="p">,</span> <span class="s1">'125'</span><span class="p">:</span> <span class="s1">'F9'</span><span class="p">,</span>
    <span class="s1">'126'</span><span class="p">:</span> <span class="s1">'Gb9'</span><span class="p">,</span> <span class="s1">'127'</span><span class="p">:</span> <span class="s1">'G9'</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1"># e57, e58 を埋めるのに使う</span>
<span class="n">ABSPITCH_TO_NOTENUM_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'xx'</span><span class="p">:</span> <span class="s1">'xx'</span><span class="p">,</span>
    <span class="s1">'C0'</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">'Db0'</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">'D0'</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">'Eb0'</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">'E0'</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">'F0'</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
    <span class="s1">'Gb0'</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">'G0'</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">'Ab0'</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">'A0'</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">'Bb0'</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">'B0'</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
    <span class="s1">'C1'</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">'Db1'</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">'D1'</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="s1">'Eb1'</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">'E1'</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s1">'F1'</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span>
    <span class="s1">'Gb1'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">'G1'</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s1">'Ab1'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s1">'A1'</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="s1">'Bb1'</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">'B1'</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
    <span class="s1">'C2'</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="s1">'Db2'</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span> <span class="s1">'D2'</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="s1">'Eb2'</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span> <span class="s1">'E2'</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">'F2'</span><span class="p">:</span> <span class="mi">41</span><span class="p">,</span>
    <span class="s1">'Gb2'</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">'G2'</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span> <span class="s1">'Ab2'</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">'A2'</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">'Bb2'</span><span class="p">:</span> <span class="mi">46</span><span class="p">,</span> <span class="s1">'B2'</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span>
    <span class="s1">'C3'</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span> <span class="s1">'Db3'</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="s1">'D3'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">'Eb3'</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span> <span class="s1">'E3'</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span> <span class="s1">'F3'</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
    <span class="s1">'Gb3'</span><span class="p">:</span> <span class="mi">54</span><span class="p">,</span> <span class="s1">'G3'</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">'Ab3'</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span> <span class="s1">'A3'</span><span class="p">:</span> <span class="mi">57</span><span class="p">,</span> <span class="s1">'Bb3'</span><span class="p">:</span> <span class="mi">58</span><span class="p">,</span> <span class="s1">'B3'</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span>
    <span class="s1">'C4'</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">'Db4'</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span> <span class="s1">'D4'</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span> <span class="s1">'Eb4'</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span> <span class="s1">'E4'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">'F4'</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
    <span class="s1">'Gb4'</span><span class="p">:</span> <span class="mi">66</span><span class="p">,</span> <span class="s1">'G4'</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span> <span class="s1">'Ab4'</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span> <span class="s1">'A4'</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span> <span class="s1">'Bb4'</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s1">'B4'</span><span class="p">:</span> <span class="mi">71</span><span class="p">,</span>
    <span class="s1">'C5'</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">'Db5'</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span> <span class="s1">'D5'</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span> <span class="s1">'Eb5'</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span> <span class="s1">'E5'</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="s1">'F5'</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span>
    <span class="s1">'Gb5'</span><span class="p">:</span> <span class="mi">78</span><span class="p">,</span> <span class="s1">'G5'</span><span class="p">:</span> <span class="mi">79</span><span class="p">,</span> <span class="s1">'Ab5'</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s1">'A5'</span><span class="p">:</span> <span class="mi">81</span><span class="p">,</span> <span class="s1">'Bb5'</span><span class="p">:</span> <span class="mi">82</span><span class="p">,</span> <span class="s1">'B5'</span><span class="p">:</span> <span class="mi">83</span><span class="p">,</span>
    <span class="s1">'C6'</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="s1">'Db6'</span><span class="p">:</span> <span class="mi">85</span><span class="p">,</span> <span class="s1">'D6'</span><span class="p">:</span> <span class="mi">86</span><span class="p">,</span> <span class="s1">'Eb6'</span><span class="p">:</span> <span class="mi">87</span><span class="p">,</span> <span class="s1">'E6'</span><span class="p">:</span> <span class="mi">88</span><span class="p">,</span> <span class="s1">'F6'</span><span class="p">:</span> <span class="mi">89</span><span class="p">,</span>
    <span class="s1">'Gb6'</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">'G6'</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span> <span class="s1">'Ab6'</span><span class="p">:</span> <span class="mi">92</span><span class="p">,</span> <span class="s1">'A6'</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span> <span class="s1">'Bb6'</span><span class="p">:</span> <span class="mi">94</span><span class="p">,</span> <span class="s1">'B6'</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
    <span class="s1">'C7'</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span> <span class="s1">'Db7'</span><span class="p">:</span> <span class="mi">97</span><span class="p">,</span> <span class="s1">'D7'</span><span class="p">:</span> <span class="mi">98</span><span class="p">,</span> <span class="s1">'Eb7'</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="s1">'E7'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">'F7'</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span>
    <span class="s1">'Gb7'</span><span class="p">:</span> <span class="mi">102</span><span class="p">,</span> <span class="s1">'G7'</span><span class="p">:</span> <span class="mi">103</span><span class="p">,</span> <span class="s1">'Ab7'</span><span class="p">:</span> <span class="mi">104</span><span class="p">,</span> <span class="s1">'A7'</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span> <span class="s1">'Bb7'</span><span class="p">:</span> <span class="mi">106</span><span class="p">,</span> <span class="s1">'B7'</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span>
    <span class="s1">'C8'</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span> <span class="s1">'Db8'</span><span class="p">:</span> <span class="mi">109</span><span class="p">,</span> <span class="s1">'D8'</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span> <span class="s1">'Eb8'</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span> <span class="s1">'E8'</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span> <span class="s1">'F8'</span><span class="p">:</span> <span class="mi">113</span><span class="p">,</span>
    <span class="s1">'Gb8'</span><span class="p">:</span> <span class="mi">114</span><span class="p">,</span> <span class="s1">'G8'</span><span class="p">:</span> <span class="mi">115</span><span class="p">,</span> <span class="s1">'Ab8'</span><span class="p">:</span> <span class="mi">116</span><span class="p">,</span> <span class="s1">'A8'</span><span class="p">:</span> <span class="mi">117</span><span class="p">,</span> <span class="s1">'Bb8'</span><span class="p">:</span> <span class="mi">118</span><span class="p">,</span> <span class="s1">'B8'</span><span class="p">:</span> <span class="mi">119</span><span class="p">,</span>
    <span class="s1">'C9'</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="s1">'Db9'</span><span class="p">:</span> <span class="mi">121</span><span class="p">,</span> <span class="s1">'D9'</span><span class="p">:</span> <span class="mi">122</span><span class="p">,</span> <span class="s1">'Eb9'</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s1">'E9'</span><span class="p">:</span> <span class="mi">124</span><span class="p">,</span> <span class="s1">'F9'</span><span class="p">:</span> <span class="mi">125</span><span class="p">,</span>
    <span class="s1">'Gb9'</span><span class="p">:</span> <span class="mi">126</span><span class="p">,</span> <span class="s1">'G9'</span><span class="p">:</span> <span class="mi">127</span>
<span class="p">}</span>


<div class="viewcode-block" id="load"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
    <span class="sd">"""HTSフルコンテキストラベル(Sinsy用)を読み取る</span>

<span class="sd">    source: path, lines</span>
<span class="sd">    """</span>
    <span class="n">song</span> <span class="o">=</span> <span class="n">HTSFullLabel</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">song</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">)</span></div>


<div class="viewcode-block" id="notenum_to_abspitch"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.notenum_to_abspitch">[docs]</a><span class="k">def</span> <span class="nf">notenum_to_abspitch</span><span class="p">(</span><span class="n">notenum</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    音高をC4のような記法に変換する</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">NOTENUM_TO_ABSPITCH_DICT</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">notenum</span><span class="p">)]</span></div>


<div class="viewcode-block" id="abspitch_to_notenum"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.abspitch_to_notenum">[docs]</a><span class="k">def</span> <span class="nf">abspitch_to_notenum</span><span class="p">(</span><span class="n">abspitch</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    音高をノート番号に変換する</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">ABSPITCH_TO_NOTENUM_DICT</span><span class="p">[</span><span class="n">abspitch</span><span class="p">]</span></div>


<div class="viewcode-block" id="HTSFullLabel"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.HTSFullLabel">[docs]</a><span class="k">class</span> <span class="nc">HTSFullLabel</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    HTSのフルコンテキストラベルの1行を扱うクラス</span>
<span class="sd">    OneLine からなる list</span>
<span class="sd">    [OneLine, OneLine, ..., OneLine]</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">song</span> <span class="o">=</span> <span class="n">Song</span><span class="p">()</span>

<div class="viewcode-block" id="HTSFullLabel.as_mono"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.HTSFullLabel.as_mono">[docs]</a>    <span class="k">def</span> <span class="nf">as_mono</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_label</span><span class="o">.</span><span class="n">Label</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        モノラベルに変換する</span>
<span class="sd">        """</span>
        <span class="n">mono_label</span> <span class="o">=</span> <span class="n">_label</span><span class="o">.</span><span class="n">Label</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">oneline</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">mono_phoneme</span> <span class="o">=</span> <span class="n">_label</span><span class="o">.</span><span class="n">Phoneme</span><span class="p">()</span>
            <span class="n">mono_phoneme</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">oneline</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="n">mono_phoneme</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">oneline</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
            <span class="n">mono_phoneme</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">oneline</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">)</span>
            <span class="n">mono_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mono_phoneme</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mono_label</span></div>

<div class="viewcode-block" id="HTSFullLabel.write"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.HTSFullLabel.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">strict_sinsy_style</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_mono</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        ファイル出力する</span>
<span class="sd">        strict_sinsy_style: bool:</span>
<span class="sd">            「休符の長さ」が前後の発声に影響するかどうかを左右する。</span>
<span class="sd">            Trueのときは d, f における休符の長さ情報が削除されて 'xx' になる。</span>
<span class="sd">            Falseのときは d, f における休符の長さ情報が維持される。</span>
<span class="sd">        """</span>
        <span class="c1"># 休符周辺の仕様をSinsyに近づける。</span>
        <span class="n">new_label</span> <span class="o">=</span> <span class="n">adjust_pau_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">strict_sinsy_style</span><span class="p">)</span>
        <span class="c1"># 文字列にする</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">new_label</span><span class="p">)))</span>

        <span class="c1"># ファイル出力</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="HTSFullLabel.load"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.HTSFullLabel.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ファイル、文字列、文字列のリスト、Songオブジェクトのいずれかより値を取得して登録する。</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_path</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_songobj</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">Song</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_songobj</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fill_contexts_from_songobj</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_lines</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_songobj</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Type of the argument "source" must be str, list or </span><span class="si">{</span><span class="n">Song</span><span class="si">}</span><span class="s1">.'</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_load_from_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'utf-8'</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ファイルをもとに値を登録する。</span>
<span class="sd">        """</span>
        <span class="c1"># パスに半角スペースが入っている場合に出現する引用符を除去</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'"'</span><span class="p">)</span>
        <span class="c1"># ファイルを読み取って行のリストにする</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'sjis'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
        <span class="c1"># 行ごとに分割したリストをもとに情報を登録する。</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_load_from_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        文字列のリスト(行のリスト)をもとに値を登録する。</span>
<span class="sd">        """</span>
        <span class="c1"># 各行を解析してHTSFullLabelに追加する。</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># 1行分の情報用のオブジェクトを生成</span>
            <span class="n">ol</span> <span class="o">=</span> <span class="n">OneLine</span><span class="p">()</span>
            <span class="c1"># 正規表現で上手く区切れない文字を置換する</span>
            <span class="c1"># 空白で分割して、時刻情報とそれ以外のコンテキストに分ける</span>
            <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">str_contexts</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># コンテキスト文字列を /A: などの文字列で区切って一次元リストにする</span>
            <span class="n">l_contexts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'/.:'</span><span class="p">,</span> <span class="n">str_contexts</span><span class="p">)</span>
            <span class="c1"># 特定の文字でさらに区切って二次元リストにする</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">'=+-~∼!@#$%^ˆ&amp;;_|[]'</span><span class="p">)</span>
            <span class="n">l_contexts_2d</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">((</span><span class="sa">f</span><span class="s1">'[</span><span class="si">{</span><span class="n">sep</span><span class="si">}</span><span class="s1">]'</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">l_contexts</span><span class="p">]</span>
            <span class="c1"># 1行分の情報用のオブジェクトに、各種コンテキストを登録する</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">l_contexts_2d</span>
            <span class="c1"># 1行分の情報用のオブジェクトを HTSFullLabel オブジェクトに追加する。</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ol</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_load_from_songobj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">songobj</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        hts.Song オブジェクトをもとにコンテキストを登録する。</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">song</span> <span class="o">=</span> <span class="n">songobj</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="HTSFullLabel.fill_contexts_from_songobj"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.HTSFullLabel.fill_contexts_from_songobj">[docs]</a>    <span class="k">def</span> <span class="nf">fill_contexts_from_songobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        自身が持つSongオブジェクトをもとにコンテキスト情報を埋める。</span>
<span class="sd">        """</span>
        <span class="n">song</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">song</span>
        <span class="n">dummy_note</span> <span class="o">=</span> <span class="n">Note</span><span class="p">()</span>
        <span class="n">dummy_syllable</span> <span class="o">=</span> <span class="n">Syllable</span><span class="p">()</span>
        <span class="n">dummy_syllable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Phoneme</span><span class="p">())</span>
        <span class="n">dummy_note</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_syllable</span><span class="p">)</span>

        <span class="n">notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">dummy_note</span><span class="p">]</span> <span class="o">+</span> <span class="n">song</span> <span class="o">+</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dummy_note</span><span class="p">)]</span>

        <span class="n">onelines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i_n</span><span class="p">,</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">syllables</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i_n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">note</span> <span class="o">+</span> <span class="n">notes</span><span class="p">[</span><span class="n">i_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i_s</span><span class="p">,</span> <span class="n">syllable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syllables</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">phoneme</span> <span class="ow">in</span> <span class="n">syllable</span><span class="p">:</span>
                    <span class="n">ol</span> <span class="o">=</span> <span class="n">OneLine</span><span class="p">()</span>
                    <span class="c1"># ノート情報を登録</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">previous_note</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i_n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="n">note</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">next_note</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># 音節情報を登録</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">previous_syllable</span> <span class="o">=</span> <span class="n">syllables</span><span class="p">[</span><span class="n">i_s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">syllable</span> <span class="o">=</span> <span class="n">syllable</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">next_syllable</span> <span class="o">=</span> <span class="n">syllables</span><span class="p">[</span><span class="n">i_s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># 音素情報を登録(現在の音素のみ)</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">phoneme</span> <span class="o">=</span> <span class="n">phoneme</span>
                    <span class="c1"># 楽曲情報を登録</span>
                    <span class="n">ol</span><span class="o">.</span><span class="n">song</span> <span class="o">=</span> <span class="n">song</span>
                    <span class="c1"># print(list(map(id, [song, note, syllable, phoneme])))</span>
                    <span class="n">onelines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">onelines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_phonemes</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="HTSFullLabel.fill_phonemes"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.HTSFullLabel.fill_phonemes">[docs]</a>    <span class="k">def</span> <span class="nf">fill_phonemes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Phoneme をもとに、前後の音素に関する項を埋める。</span>
<span class="sd">        """</span>
        <span class="n">extended_self</span> <span class="o">=</span> <span class="p">[</span><span class="n">OneLine</span><span class="p">(),</span> <span class="n">OneLine</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="p">[</span><span class="n">OneLine</span><span class="p">(),</span> <span class="n">OneLine</span><span class="p">()]</span>
        <span class="c1"># ol is OneLine objec</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extended_self</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">before_previous_phoneme</span> <span class="o">=</span> <span class="n">extended_self</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">phoneme</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">previous_phoneme</span> <span class="o">=</span> <span class="n">extended_self</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">phoneme</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">next_phoneme</span> <span class="o">=</span> <span class="n">extended_self</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">phoneme</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">after_next_phoneme</span> <span class="o">=</span> <span class="n">extended_self</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">phoneme</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="HTSFullLabel.generate_songobj"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.HTSFullLabel.generate_songobj">[docs]</a>    <span class="k">def</span> <span class="nf">generate_songobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        フルコンテキストラベルの情報をもとにSongオブジェクトをつくる。</span>
<span class="sd">        self.song に格納する。</span>
<span class="sd">        """</span>
        <span class="c1"># Song は1つの HTSFullLabel につき1つだけなので、ループする必要がない。</span>
        <span class="c1"># Song は一番最初の行の情報がすべての行に通用すると考える。</span>
        <span class="n">song</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">song</span>
        <span class="n">song</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">Note</span><span class="p">()</span>
        <span class="n">syllable</span> <span class="o">=</span> <span class="n">Syllable</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">phoneme</span> <span class="o">=</span> <span class="n">ol</span><span class="o">.</span><span class="n">phoneme</span>
            <span class="c1"># すでに入っている音節や音素を取り除く。取り除かないと数が倍になる。</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ol</span><span class="o">.</span><span class="n">syllable</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># 休符のときは無条件でノートと音節を切り替える。</span>
            <span class="k">if</span> <span class="n">ol</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">note</span> <span class="o">=</span> <span class="n">ol</span><span class="o">.</span><span class="n">note</span>
                <span class="n">song</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
                <span class="n">syllable</span> <span class="o">=</span> <span class="n">ol</span><span class="o">.</span><span class="n">syllable</span>
                <span class="n">note</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">syllable</span><span class="p">)</span>
            <span class="c1"># 休符以外のとき</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 処理する行が「ノート内で1番最初の音節」かつ</span>
                <span class="c1"># 「音節内でいちばん最初の音素」のとき、ノートを切り替える。</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ol</span><span class="o">.</span><span class="n">syllable</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'1'</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">phoneme</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'1'</span><span class="p">:</span>
                    <span class="n">note</span> <span class="o">=</span> <span class="n">ol</span><span class="o">.</span><span class="n">note</span>
                    <span class="n">song</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
                <span class="c1"># 処理する行が「音節内で1番最初の音素」なとき、音節を切り替える。</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">phoneme</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'1'</span><span class="p">:</span>
                    <span class="n">syllable</span> <span class="o">=</span> <span class="n">ol</span><span class="o">.</span><span class="n">syllable</span>
                    <span class="n">note</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">syllable</span><span class="p">)</span>
            <span class="n">syllable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phoneme</span><span class="p">)</span>

        <span class="n">song</span><span class="o">.</span><span class="n">autofill</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">song</span> <span class="o">=</span> <span class="n">song</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_contexts_from_songobj</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="OneLine"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.OneLine">[docs]</a><span class="k">class</span> <span class="nc">OneLine</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    HTSのフルコンテキストラベルの1行を扱うクラス</span>
<span class="sd">    ファイルを読み取って HTSFullLabel を生成するときと、</span>
<span class="sd">    HTSFullLabel をファイル入出力するときに使う。</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">before_previous_phoneme</span> <span class="o">=</span> <span class="n">Phoneme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_phoneme</span> <span class="o">=</span> <span class="n">Phoneme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span> <span class="o">=</span> <span class="n">Phoneme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_phoneme</span> <span class="o">=</span> <span class="n">Phoneme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">after_next_phoneme</span> <span class="o">=</span> <span class="n">Phoneme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_syllable</span> <span class="o">=</span> <span class="n">Syllable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syllable</span> <span class="o">=</span> <span class="n">Syllable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_syllable</span> <span class="o">=</span> <span class="n">Syllable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_note</span> <span class="o">=</span> <span class="n">Note</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="n">Note</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_note</span> <span class="o">=</span> <span class="n">Note</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_phrase</span> <span class="o">=</span> <span class="n">Phrase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phrase</span> <span class="o">=</span> <span class="n">Phrase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_phrase</span> <span class="o">=</span> <span class="n">Phrase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">song</span> <span class="o">=</span> <span class="n">Song</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_self</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
            <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s1"> '</span><span class="p">,</span>
            <span class="c1"># Phoneme 関連</span>
            <span class="s1">'</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">%</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">!</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">$</span><span class="si">{}</span><span class="s1">]</span><span class="si">{}</span><span class="s1">'</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">),</span>
            <span class="c1"># Syllable 関連</span>
            <span class="s1">'/A:</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">),</span>
            <span class="s1">'/B:</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">|</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">),</span>
            <span class="s1">'/C:</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">&amp;</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">),</span>
            <span class="c1"># Note 関連</span>
            <span class="s1">'/D:</span><span class="si">{}</span><span class="s1">!</span><span class="si">{}</span><span class="s1">#</span><span class="si">{}</span><span class="s1">$</span><span class="si">{}</span><span class="s1">%</span><span class="si">{}</span><span class="s1">|</span><span class="si">{}</span><span class="s1">&amp;</span><span class="si">{}</span><span class="s1">;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">),</span>
            <span class="s1">'/E:</span><span class="si">{}</span><span class="s1">]</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">!</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">#</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">]</span><span class="si">{}</span><span class="s1">$</span><span class="si">{}</span><span class="s1">|</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">&amp;</span><span class="si">{}</span><span class="s1">]</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">#</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">;</span><span class="si">{}</span><span class="s1">$</span><span class="si">{}</span><span class="s1">&amp;</span><span class="si">{}</span><span class="s1">%</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">|</span><span class="si">{}</span><span class="s1">]</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">$</span><span class="si">{}</span><span class="s1">!</span><span class="si">{}</span><span class="s1">%</span><span class="si">{}</span><span class="s1">#</span><span class="si">{}</span><span class="s1">|</span><span class="si">{}</span><span class="s1">|</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&amp;</span><span class="si">{}</span><span class="s1">&amp;</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">;</span><span class="si">{}</span><span class="s1">]</span><span class="si">{}</span><span class="s1">;</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">#</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">!</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">!</span><span class="si">{}</span><span class="s1">^</span><span class="si">{}</span><span class="s1">'</span> \
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">),</span>
            <span class="s1">'/F:</span><span class="si">{}</span><span class="s1">#</span><span class="si">{}</span><span class="s1">#</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">$</span><span class="si">{}</span><span class="s1">$</span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">%</span><span class="si">{}</span><span class="s1">;</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">),</span>
            <span class="c1"># Phrase 関連</span>
            <span class="s1">'/G:</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">),</span>
            <span class="s1">'/H:</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">),</span>
            <span class="s1">'/I:</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">),</span>
            <span class="c1"># Song 関連</span>
            <span class="s1">'/J:</span><span class="si">{}</span><span class="s1">~</span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>
        <span class="p">))</span>
        <span class="k">return</span> <span class="n">str_self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        発声開始時刻</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

    <span class="nd">@start</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        発声終了時刻</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>

    <span class="nd">@end</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">p</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        音素に関するコンテキスト</span>
<span class="sd">        """</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">before_previous_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">after_next_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">before_previous_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">after_next_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">position_backward</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">distance_from_previous_vowel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">distance_to_next_vowel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">undefined_context</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">p</span>

    <span class="nd">@p</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phoneme_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">before_previous_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">previous_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">next_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">after_next_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">before_previous_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">previous_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">next_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">after_next_phoneme</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">position_backward</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">distance_from_previous_vowel</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">distance_to_next_vowel</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">phoneme</span><span class="o">.</span><span class="n">undefined_context</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">phoneme_contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        直前の音節のコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_syllable</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@a</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syllable_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_syllable</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">syllable_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        現在の音節のコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">syllable</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@b</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syllable_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syllable</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">syllable_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        直後の音節のコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_syllable</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@c</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syllable_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_syllable</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">syllable_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        直前のノートのコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_note</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@d</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_note</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">note_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        現在のノートのコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@e</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">note_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        直後のノートのコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_note</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@f</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_note</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">note_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        直前のフレーズのコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_phrase</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@g</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phrase_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_phrase</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">phrase_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        現在のフレーズのコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phrase</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@h</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phrase_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phrase</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">phrase_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">i</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        直後のフレーズのコンテキスト</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_phrase</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@i</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phrase_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_phrase</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">phrase_contexts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">j</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        (現在の)楽曲のコンテキスト</span>
<span class="sd">        1ファイル1曲。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">song</span><span class="o">.</span><span class="n">contexts</span>

    <span class="nd">@j</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">song_contexts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">song</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">song_contexts</span></div>


<div class="viewcode-block" id="Song"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Song">[docs]</a><span class="k">class</span> <span class="nc">Song</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    曲を扱うクラス</span>
<span class="sd">    今日の曲(j1-j3)</span>
<span class="sd">    [Phrase, Phrase, ..., Phrase]</span>
<span class="sd">    [Note, Note, ..., Note]</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_measures</span> <span class="o">=</span> <span class="s1">'xx'</span>

    <span class="c1"># @property</span>
    <span class="c1"># def all_phrases(self):</span>
    <span class="c1">#     """</span>
    <span class="c1">#     Phraseをすべて並べたリストを返す。</span>
    <span class="c1">#     """</span>
    <span class="c1">#     return self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_notes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Noteをすべて並べたリストを返す。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_syllables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Syllableをすべて並べたリストを返す。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_phonemes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Phonemeをすべて並べたリストを返す。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_syllables</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">number_of_phrases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        楽曲内のフレーズ数。(j3)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@number_of_phrases</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_phrases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">number</span>

<div class="viewcode-block" id="Song.as_mono"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Song.as_mono">[docs]</a>    <span class="k">def</span> <span class="nf">as_mono</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_label</span><span class="o">.</span><span class="n">Label</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        モノラベルに変換する</span>
<span class="sd">        """</span>
        <span class="n">mono_label</span> <span class="o">=</span> <span class="n">_label</span><span class="o">.</span><span class="n">Label</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">full_phoneme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_phonemes</span><span class="p">:</span>
            <span class="n">mono_phoneme</span> <span class="o">=</span> <span class="n">_label</span><span class="o">.</span><span class="n">Phoneme</span><span class="p">()</span>
            <span class="n">mono_phoneme</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">full_phoneme</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="n">mono_phoneme</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">full_phoneme</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
            <span class="n">mono_phoneme</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">full_phoneme</span><span class="o">.</span><span class="n">identity</span><span class="p">)</span>
            <span class="n">mono_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mono_phoneme</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mono_label</span></div>

<div class="viewcode-block" id="Song.write"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Song.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">strict_sinsy_style</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_mono</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">HTSFullLabel</span><span class="p">,</span> <span class="n">_label</span><span class="o">.</span><span class="n">Label</span><span class="p">]:</span>
        <span class="sd">"""</span>
<span class="sd">        ファイル出力する。</span>
<span class="sd">        HTSFullLabelからではなく、USTなどからSongが直接生成されている場合に対応する。</span>
<span class="sd">        """</span>
        <span class="n">full_label</span> <span class="o">=</span> <span class="n">HTSFullLabel</span><span class="p">()</span>
        <span class="n">full_label</span><span class="o">.</span><span class="n">song</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">full_label</span><span class="o">.</span><span class="n">fill_contexts_from_songobj</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">as_mono</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">mono_label</span> <span class="o">=</span> <span class="n">full_label</span><span class="o">.</span><span class="n">as_mono</span><span class="p">()</span>
            <span class="n">mono_label</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mono_label</span>

        <span class="n">full_label</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">strict_sinsy_style</span><span class="o">=</span><span class="n">strict_sinsy_style</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">full_label</span></div>

<div class="viewcode-block" id="Song.reset_time"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Song.reset_time">[docs]</a>    <span class="k">def</span> <span class="nf">reset_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノート長をもとに、Sinsyの出力と同じになるように、</span>
<span class="sd">        Phonemeオブジェクトのstartとendを計算して登録する。</span>

<span class="sd">        単位は100ns</span>
<span class="sd">        100ns単位での長さがすでに計算されているものとする。(note.length_100ns)</span>
<span class="sd">        """</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">t_end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">:</span>
            <span class="n">phonemes_in_note</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">note</span><span class="p">))</span>
            <span class="n">t_end</span> <span class="o">+=</span> <span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span>
            <span class="k">for</span> <span class="n">phoneme</span> <span class="ow">in</span> <span class="n">phonemes_in_note</span><span class="p">:</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">t_start</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>
            <span class="n">t_start</span> <span class="o">=</span> <span class="n">t_end</span></div>

<div class="viewcode-block" id="Song.autofill"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Song.autofill">[docs]</a>    <span class="k">def</span> <span class="nf">autofill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hts_conf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        自動補完可能なものをすべて自動補完する。</span>
<span class="sd">        """</span>
        <span class="c1"># この順でやらないと、p1が未設定の状態で Note.is_rest() をやってしまう</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_phoneme_contexts</span><span class="p">(</span><span class="n">hts_conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_syllable_contexts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_note_contexts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_song_contexts</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_fill_phoneme_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hts_conf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]):</span>
        <span class="sd">"""</span>
<span class="sd">        p1, p12, p13, p14, p15 を補完する。</span>
<span class="sd">        """</span>
        <span class="c1"># p12, p13, p14, p15を埋める</span>
        <span class="k">if</span> <span class="n">hts_conf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_p1</span><span class="p">(</span><span class="n">vowels</span><span class="o">=</span><span class="n">VOWELS</span><span class="p">,</span> <span class="n">pauses</span><span class="o">=</span><span class="n">PAUSES</span><span class="p">,</span> <span class="n">silences</span><span class="o">=</span><span class="n">SILENCES</span><span class="p">,</span> <span class="n">breaks</span><span class="o">=</span><span class="n">BREAKS</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_p1</span><span class="p">(</span><span class="n">vowels</span><span class="o">=</span><span class="n">hts_conf</span><span class="p">[</span><span class="s1">'VOWELS'</span><span class="p">],</span> <span class="n">pauses</span><span class="o">=</span><span class="n">hts_conf</span><span class="p">[</span><span class="s1">'PAUSES'</span><span class="p">],</span>
                          <span class="n">silences</span><span class="o">=</span><span class="n">hts_conf</span><span class="p">[</span><span class="s1">'SILENCES'</span><span class="p">],</span> <span class="n">breaks</span><span class="o">=</span><span class="n">hts_conf</span><span class="p">[</span><span class="s1">'BREAKS'</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_p12_p13</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_p14_p15</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_fill_p1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vowels</span><span class="p">,</span> <span class="n">pauses</span><span class="p">,</span> <span class="n">silences</span><span class="p">,</span> <span class="n">breaks</span><span class="p">):</span>
        <span class="c1"># p1 を埋める</span>
        <span class="k">for</span> <span class="n">phoneme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_phonemes</span><span class="p">:</span>
            <span class="n">phoneme_identity</span> <span class="o">=</span> <span class="n">phoneme</span><span class="o">.</span><span class="n">identity</span>
            <span class="k">if</span> <span class="n">phoneme_identity</span> <span class="o">==</span> <span class="s1">'xx'</span><span class="p">:</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">=</span> <span class="s1">'xx'</span>
            <span class="k">elif</span> <span class="n">phoneme_identity</span> <span class="ow">in</span> <span class="n">vowels</span><span class="p">:</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">=</span> <span class="s1">'v'</span>
            <span class="k">elif</span> <span class="n">phoneme_identity</span> <span class="ow">in</span> <span class="n">pauses</span><span class="p">:</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">=</span> <span class="s1">'p'</span>
            <span class="k">elif</span> <span class="n">phoneme_identity</span> <span class="ow">in</span> <span class="n">silences</span><span class="p">:</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">=</span> <span class="s1">'s'</span>
            <span class="k">elif</span> <span class="n">phoneme_identity</span> <span class="ow">in</span> <span class="n">breaks</span><span class="p">:</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">=</span> <span class="s1">'b'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">=</span> <span class="s1">'c'</span>

    <span class="k">def</span> <span class="nf">_fill_p12_p13</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        p12 と p13 (音節内での位置) を補完する。</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">syllable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_syllables</span><span class="p">:</span>
            <span class="n">len_syllable</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">syllable</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">phoneme</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syllable</span><span class="p">):</span>
                <span class="c1"># p12</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># p13</span>
                <span class="n">phoneme</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">=</span> <span class="n">len_syllable</span> <span class="o">-</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">_fill_p14_p15</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        p14 と p15 (母音からの距離) を補完する。</span>
<span class="sd">        """</span>
        <span class="c1"># p14</span>
        <span class="k">for</span> <span class="n">syllable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_syllables</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">phoneme</span> <span class="ow">in</span> <span class="n">syllable</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">phoneme</span><span class="o">.</span><span class="n">is_vowel</span><span class="p">():</span>
                    <span class="n">phoneme</span><span class="o">.</span><span class="n">distance_from_previous_vowel</span> <span class="o">=</span> <span class="s1">'xx'</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">phoneme</span><span class="o">.</span><span class="n">is_consonant</span><span class="p">():</span>
                    <span class="n">phoneme</span><span class="o">.</span><span class="n">distance_from_previous_vowel</span> <span class="o">=</span> <span class="n">distance</span>
                    <span class="n">distance</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># 母音でも子音でもない場合(clとか)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># p15</span>
        <span class="k">for</span> <span class="n">syllable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_syllables</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">phoneme</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">syllable</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">phoneme</span><span class="o">.</span><span class="n">is_vowel</span><span class="p">():</span>
                    <span class="n">phoneme</span><span class="o">.</span><span class="n">distance_to_next_vowel</span> <span class="o">=</span> <span class="s1">'xx'</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">phoneme</span><span class="o">.</span><span class="n">is_consonant</span><span class="p">():</span>
                    <span class="n">phoneme</span><span class="o">.</span><span class="n">distance_to_next_vowel</span> <span class="o">=</span> <span class="n">distance</span>
                    <span class="n">distance</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># 母音でも子音でもない場合(clとか)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_fill_syllable_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        b1, b2, b3 を補完する。</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">:</span>
            <span class="n">len_note</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">syllable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
                <span class="c1"># b1</span>
                <span class="n">syllable</span><span class="o">.</span><span class="n">number_of_phonemes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">syllable</span><span class="p">)</span>
                <span class="c1"># b2</span>
                <span class="n">syllable</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># b3</span>
                <span class="n">syllable</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">=</span> <span class="n">len_note</span> <span class="o">-</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">_fill_note_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""e を補完する。</span>

<span class="sd">        必要なデータ:</span>
<span class="sd">            - e1: 絶対音高</span>
<span class="sd">            - e5: テンポ</span>
<span class="sd">            - e8: ノート長(96分音符)</span>
<span class="sd">        補完するデータ:</span>
<span class="sd">            - e6: ノート内音節数</span>
<span class="sd">            - e7: ノート長(10ms)</span>
<span class="sd">            - e18-e25: フレーズ内での位置</span>
<span class="sd">                - e20, e21: フレーズ内での位置(100ms)</span>
<span class="sd">                - e22, e23: フレーズ内での位置(96分音符)</span>
<span class="sd">                - e24, e25: フレーズ内での位置(パーセント)</span>
<span class="sd">            - Note.position_100ns</span>
<span class="sd">            - Note.position_100ns_backward</span>
<span class="sd">            - e57-e58: 前後のノートとの音高差</span>
<span class="sd">        """</span>
        <span class="c1"># e6, e7 を埋める。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">:</span>
            <span class="c1"># e6 (ノート内音節数) を埋める</span>
            <span class="n">note</span><span class="o">.</span><span class="n">number_of_syllables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
            <span class="c1"># e8 の情報をもとに e7 を埋める。テンポ情報(e5)がないと困る。</span>
            <span class="c1"># 100ns単位での長さも登録する。</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">tempo</span> <span class="o">!=</span> <span class="s1">'xx'</span> <span class="ow">and</span> <span class="n">note</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="s1">'xx'</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">length_10ms</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span> <span class="o">/</span> <span class="mi">100000</span>
                                           <span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>

        <span class="c1"># フレーズ内で何番目のノートかを埋める</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_e18_e19</span><span class="p">()</span>
        <span class="c1"># フレーズ内での 96分音符単位での位置を埋める。e18,e19が必要。</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_e22_e23</span><span class="p">()</span>
        <span class="c1"># フレーズ内での 100ms単位での位置を埋める。e18,e19が必要。</span>
        <span class="c1"># フレーズ内での 100ns単位での位置も埋める(utaupy独自コンテキスト)。</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_e20_e21_100ns</span><span class="p">()</span>
        <span class="c1"># フレーズ内での パーセント表記での位置を埋める。e18, e19, 100ns位置が必要</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_e24_e25</span><span class="p">()</span>
        <span class="c1"># 音高の前後変化を埋める</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_e57_e58</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_fill_e18_e19</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        「Phrase内で何番目か(e18, e19)」の項を埋める。</span>
<span class="sd">        Phraseの扱いは難しいので、「休符からの距離」を代わりに用いる。</span>
<span class="sd">        """</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span>

        <span class="c1"># 最初のノートが休符でなくても動作するようにする。</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 直前の休符からの距離を数える</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="c1"># 休符のときは距離をリセット</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="s1">'xx'</span>
            <span class="c1"># 休符ではなく、休符位置が分かっているときは登録</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">counter</span>

        <span class="c1"># 最後のノートが休符でなくても動作するようにする。</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 次の休符までの距離を登録する。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">notes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">=</span> <span class="s1">'xx'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">=</span> <span class="n">counter</span>

    <span class="k">def</span> <span class="nf">_fill_e20_e21_100ns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        「フレーズ内での位置(100ms単位での表記) (e20, e21)」の項を埋める。</span>

<span class="sd">        e18とe19のデータがある前提で実行する。</span>
<span class="sd">        10msでの累計だとずれるので100nsで計算してから10msに直して登録する。</span>
<span class="sd">        """</span>

        <span class="n">counter_100ns</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># 前の休符から数えた時間を登録する。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">:</span>
            <span class="c1"># 休符のときは 'xx'</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">'xx'</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ms</span> <span class="o">=</span> <span class="s1">'xx'</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ns</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">counter_100ns</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># フレーズ中で最初のノートのときは時間をリセットして、累積時間を増やす。</span>
            <span class="k">elif</span> <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ms</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ns</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counter_100ns</span> <span class="o">+=</span> <span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span>
            <span class="c1"># 休符でもなくて最初のノートでもないとき</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ms</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span>
                    <span class="n">counter_100ns</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ns</span> <span class="o">=</span> <span class="n">counter_100ns</span>
                <span class="n">counter_100ns</span> <span class="o">+=</span> <span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span>

        <span class="n">counter_100ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 次の休符から数えた時間を登録する。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">):</span>
            <span class="c1"># 休符のときは 'xx'</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">==</span> <span class="s1">'xx'</span><span class="p">:</span>
                <span class="n">counter_100ns</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ms_backward</span> <span class="o">=</span> <span class="s1">'xx'</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ns_backward</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># フレーズ中で最後のノートのときは時間をリセットして、累積時間を増やす。</span>
            <span class="k">elif</span> <span class="n">note</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">counter_100ns</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ms_backward</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span>
                    <span class="n">counter_100ns</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ns_backward</span> <span class="o">=</span> <span class="n">counter_100ns</span>
            <span class="c1"># 休符でもなくて最後のノートでもないとき</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counter_100ns</span> <span class="o">+=</span> <span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ms_backward</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span>
                    <span class="n">counter_100ns</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>
                <span class="n">note</span><span class="o">.</span><span class="n">position_100ns_backward</span> <span class="o">=</span> <span class="n">counter_100ns</span>

    <span class="k">def</span> <span class="nf">_fill_e22_e23</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""「フレーズ内での位置(96分音符単位) (e22, e23)」の項を埋める。</span>

<span class="sd">        e18とe19のデータがある前提で実行する。</span>
<span class="sd">        """</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 前の休符から数えた時間を登録する。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">:</span>
            <span class="c1"># 休符のときは 'xx'</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">'xx'</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'xx'</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># フレーズ中で最初のノートのときは時間をリセットして、累積時間を増やす。</span>
            <span class="k">elif</span> <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
            <span class="c1"># 休符でもなくて最初のノートでもないとき</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 次の休符から数えた時間を登録する。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span><span class="p">):</span>
            <span class="c1"># 休符のときは 'xx'</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">==</span> <span class="s1">'xx'</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'xx'</span>
            <span class="c1"># フレーズ中で最後のノートのときは時間をリセットして、累積時間を増やす。</span>
            <span class="k">elif</span> <span class="n">note</span><span class="o">.</span><span class="n">position_backward</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span>
            <span class="c1"># 休符でもなくて最後のノートでもないときは普通に登録して、累積時間を増やす。</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span>

    <span class="k">def</span> <span class="nf">_fill_e24_e25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        「フレーズ内での位置(パーセント表記) (e24, e25)」の項を埋める。</span>
<span class="sd">        e18, e19, length_100ns のデータがある前提で実行する。</span>
<span class="sd">        """</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span>
        <span class="c1"># フレーズの全体の長さ</span>
        <span class="n">phrase_length_100ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">counter_100ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">'xx'</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">phrase_length_100ns</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counter_100ns</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'xx'</span>
            <span class="k">elif</span> <span class="n">note</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">phrase_length_100ns</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">position_100ns_backward</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">counter_100ns</span> <span class="o">/</span> <span class="n">phrase_length_100ns</span>
                                            <span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>
                <span class="n">counter_100ns</span> <span class="o">+=</span> <span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">counter_100ns</span> <span class="o">/</span> <span class="n">phrase_length_100ns</span>
                                            <span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span>
                <span class="n">counter_100ns</span> <span class="o">+=</span> <span class="n">note</span><span class="o">.</span><span class="n">length_100ns</span>

        <span class="c1"># NOTE: 次のブロックの処理でうまくいかなかった場合、コメント部分のコードを使う。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">position_percent</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position_percent</span> <span class="o">==</span> <span class="s1">'xx'</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'xx'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span>
        <span class="c1"># NOTE: 上のブロックが動かなかったらここを使う</span>
        <span class="c1"># # フレーズの全体の長さ</span>
        <span class="c1"># phrase_length_100ns = 0</span>
        <span class="c1"># counter_100ns = 0</span>
        <span class="c1"># for note in reversed(self.all_notes):</span>
        <span class="c1">#     # 休符のときは 'xx'</span>
        <span class="c1">#     if note.position_backward == 'xx' or note.is_rest():</span>
        <span class="c1">#         phrase_length_100ns = 0</span>
        <span class="c1">#         counter_100ns = 0</span>
        <span class="c1">#         note.contexts[24] = 'xx'</span>
        <span class="c1">#     # フレーズ中で最後のノートのときは時間をリセットして、累積時間を増やす。</span>
        <span class="c1">#     elif note.position_backward == 1:</span>
        <span class="c1">#         phrase_length_100ns = note.position_100ns + note.length_100ns</span>
        <span class="c1">#         counter_100ns = note.length_100ns</span>
        <span class="c1">#         note.contexts[24] = Decimal(100 * counter_100ns / phrase_length_100ns</span>
        <span class="c1">#                                     ).quantize(Decimal('0'), rounding=ROUND_HALF_UP)</span>
        <span class="c1">#     # 休符でもなくて最後のノートでもないときは普通に登録して、累積時間を増やす。</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         counter_100ns += note.length_100ns</span>
        <span class="c1">#         note.contexts[24] = Decimal(100 * counter_100ns / phrase_length_100ns</span>
        <span class="c1">#                                     ).quantize(Decimal('0'), rounding=ROUND_HALF_UP)</span>

    <span class="k">def</span> <span class="nf">_fill_e57_e58</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        「前後のノートとの音高差 (e57, e58)」の項を埋める。</span>
<span class="sd">        e1がある前提で実行する。</span>
<span class="sd">        休符が入ると死ぬw</span>
<span class="sd">        """</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span>
        <span class="c1"># e57を埋める</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">previous_note</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">previous_abspitch</span> <span class="o">=</span> <span class="n">previous_note</span><span class="o">.</span><span class="n">absolute_pitch</span>
            <span class="n">current_abspitch</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">absolute_pitch</span>
            <span class="c1"># 直前のノートまたは今のノートが休符のときはスキップ</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">previous_note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()):</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">56</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'xx'</span>
                <span class="k">continue</span>
            <span class="c1"># 直前のノートも今のノートも音符のとき</span>
            <span class="n">previous_notenum</span> <span class="o">=</span> <span class="n">abspitch_to_notenum</span><span class="p">(</span><span class="n">previous_abspitch</span><span class="p">)</span>
            <span class="n">current_notenum</span> <span class="o">=</span> <span class="n">abspitch_to_notenum</span><span class="p">(</span><span class="n">current_abspitch</span><span class="p">)</span>
            <span class="n">pitch_difference</span> <span class="o">=</span> <span class="n">previous_notenum</span> <span class="o">-</span> <span class="n">current_notenum</span>
            <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">56</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="s2">"p"</span> <span class="k">if</span> <span class="n">pitch_difference</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">"m"</span><span class="si">}{</span><span class="nb">abs</span><span class="p">(</span><span class="n">pitch_difference</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>

        <span class="c1"># e58 を埋める</span>
        <span class="c1"># 処理内容を比較しやすいようにprevious_noteにしているが、実際はnext_note</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">notes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">previous_note</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
            <span class="n">previous_abspitch</span> <span class="o">=</span> <span class="n">previous_note</span><span class="o">.</span><span class="n">absolute_pitch</span>
            <span class="n">current_abspitch</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">absolute_pitch</span>
            <span class="c1"># 直後のノートまたは今のノートが休符のときはスキップ</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">previous_note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()):</span>
                <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">57</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'xx'</span>
                <span class="k">continue</span>
            <span class="c1"># 直前のノートも今のノートも音符のとき</span>
            <span class="n">previous_notenum</span> <span class="o">=</span> <span class="n">abspitch_to_notenum</span><span class="p">(</span><span class="n">previous_abspitch</span><span class="p">)</span>
            <span class="n">current_notenum</span> <span class="o">=</span> <span class="n">abspitch_to_notenum</span><span class="p">(</span><span class="n">current_abspitch</span><span class="p">)</span>
            <span class="n">pitch_difference</span> <span class="o">=</span> <span class="n">previous_notenum</span> <span class="o">-</span> <span class="n">current_notenum</span>
            <span class="n">note</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">57</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="s2">"p"</span> <span class="k">if</span> <span class="n">pitch_difference</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">"m"</span><span class="si">}{</span><span class="nb">abs</span><span class="p">(</span><span class="n">pitch_difference</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>

    <span class="k">def</span> <span class="nf">_fill_song_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Songオブジェクトのコンテキストを自動補完する。</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_j3</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_fill_j3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Songオブジェクト内のフレーズ数(j3) の項を埋める。</span>
<span class="sd">        """</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_notes</span>
        <span class="n">previous_note_is_rest</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 最初が音符だった時はフレーズ数1からスタート</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">previous_note_is_rest</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
        <span class="c1"># 休符→音符 の並びの回数を検出する。</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">current_note_is_rest</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">previous_note_is_rest</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">current_note_is_rest</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">previous_note_is_rest</span> <span class="o">=</span> <span class="n">current_note_is_rest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_phrases</span> <span class="o">=</span> <span class="n">counter</span></div>


<div class="viewcode-block" id="Phrase"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Phrase">[docs]</a><span class="k">class</span> <span class="nc">Phrase</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">"""フレーズを扱うクラス</span>

<span class="sd">    昨日のフレーズ G (g1~g2)</span>
<span class="sd">    今日のフレーズ H (h1~h2)</span>
<span class="sd">    明日のフレーズ I (i1~i2)</span>
<span class="sd">    基本的にはHのみを操作する。</span>
<span class="sd">    [Note, Note, Note, ..., Note]</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">number_of_syllables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        フレーズ内の音節数。</span>

<span class="sd">        OneLine からSongを生成するときに使うかも。</span>
<span class="sd">        フレーズの切り替わり判定をするときに使うかも。</span>
<span class="sd">        多分使わない。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">number_of_syllables</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_syllables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">number</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">number_of_phonemes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        フレーズ内の音素数。</span>
<span class="sd">        OneLine からSongを生成するときに使う。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">number_of_phonemes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_phonemes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">number</span></div>


<div class="viewcode-block" id="Note"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Note">[docs]</a><span class="k">class</span> <span class="nc">Note</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    ノートまたは休符を扱うクラス</span>
<span class="sd">    1ノート（ノートと休符）を扱うクラス</span>
<span class="sd">    昨日のノート D (d1~d5)</span>
<span class="sd">    今日のノート E (e1~e60)</span>
<span class="sd">    明日のノート F (f1~f5)</span>
<span class="sd">    基本的にはEのみを操作する。</span>
<span class="sd">    [Syllable, Syllable, ..., Syllable]</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_100ns</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_100ns_backward</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">absolute_pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノートの絶対音高 (C0-G9) (e1)</span>
<span class="sd">        # TODO: 番号でもsetできるようにする。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">absolute_pitch</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">absolute_pitch</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">absolute_pitch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">notenum</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        absolute_pitch: C0-G9 のような表記</span>
<span class="sd">        notenum: MIDIなどの note number による表記(C-1:0 ~ G9:127)</span>
<span class="sd">        """</span>
        <span class="c1"># どちらか片方は必須だし、</span>
        <span class="c1"># 片方しか利用できませんよというやつ</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">absolute_pitch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">notenum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">absolute_pitch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">absolute_pitch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">notenum_to_abspitch</span><span class="p">(</span><span class="n">notenum</span><span class="p">)</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">relative_pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        ノートの相対音高(p2)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">relative_pitch</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">relative_pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_pitch</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative_pitch</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノートのキー(p3)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">key</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">beat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        拍子情報(p4)</span>
<span class="sd">        3/4 とか 4/4 とか 6/8 とか</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">beat</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">beat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beat</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">beat</span><span class="p">)</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">notenum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        音高をノート番号で取得する</span>
<span class="sd">        ラベルファイルには記録されないが、</span>
<span class="sd">        C4のような表記でe1に記録される。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">abspitch_to_notenum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolute_pitch</span><span class="p">)</span>

    <span class="o">@</span> <span class="n">notenum</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">notenum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notenum</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolute_pitch</span> <span class="o">=</span> <span class="n">notenum_to_abspitch</span><span class="p">(</span><span class="n">notenum</span><span class="p">)</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">tempo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        テンポ(e5)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">tempo</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tempo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tempo</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempo</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">number_of_syllables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノート内音節数(e6)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">number_of_syllables</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_syllables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">number</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">length_10ms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノート長(e7)</span>
<span class="sd">        10ms単位の整数で計算</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">length_10ms</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">length_10ms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">length</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノート長(e8)</span>
<span class="sd">        96分音符いくつ分かで計算</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">length</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">length</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">length_100ns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノート長(ラベル出力なし)</span>
<span class="sd">        100ns単位の整数で計算</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="s1">'xx'</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">'xx'</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000000</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempo</span><span class="p">))</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        フレーズ内での位置(e18)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">position</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">position_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        フレーズ内での後ろから数えた位置(e19)</span>
<span class="sd">        1-indexed</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">position_backward</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">position_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position_backward</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_backward</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">position_100ms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        フレーズ内での位置(e20)</span>
<span class="sd">        100ms単位</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">position_100ms</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">position_100ms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">position_100ms_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        フレーズ内での後ろから数えた位置(e21)</span>
<span class="sd">        100ms単位</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">position_100ms_backward</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">position_100ms_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position_backward</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_backward</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">phonemes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Note内のすべてのPhonemeオブジェクトを並べたリストを返す。</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

<div class="viewcode-block" id="Note.is_rest"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Note.is_rest">[docs]</a>    <span class="k">def</span> <span class="nf">is_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        休符かどうかを返す</span>
<span class="sd">        ノート内の最初の音素が休符かどうかで判断する</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()</span></div>

<div class="viewcode-block" id="Note.is_pau"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Note.is_pau">[docs]</a>    <span class="k">def</span> <span class="nf">is_pau</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        後方互換のために残している。</span>
<span class="sd">        'is_pau()' is now 'is_rest()'</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Syllable"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Syllable">[docs]</a><span class="k">class</span> <span class="nc">Syllable</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    1音節を扱うクラス</span>
<span class="sd">    昨日の音節 A (a1~a5)</span>
<span class="sd">    今日の音節 B (b1~b5)</span>
<span class="sd">    明日の音節 C (c1~c5)</span>
<span class="sd">    [Phoneme, Phoneme, ..., Phoneme]</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">number_of_phonemes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        音節内の音素数(b1)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">number_of_phonemes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_phonemes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">number</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        ノート内での位置(b2)</span>
<span class="sd">        1-indexed</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">position</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">position_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>

<span class="sd">        ノート内での後ろから数えた位置(b3)</span>
<span class="sd">        1-indexed</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="o">@</span> <span class="n">position_backward</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">position_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position_backward</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_backward</span></div>


<div class="viewcode-block" id="Phoneme"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Phoneme">[docs]</a><span class="k">class</span> <span class="nc">Phoneme</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    音素を扱うクラス</span>
<span class="sd">    p1~p16</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 発声開始時刻</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 発声終了時刻</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># p1: 言語非依存の音素記号(p, c, v など)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language_independent_identity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="c1"># p4: 音素記号</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="c1"># p9: フラグ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="c1"># p12: 音節(Syllable)内の、先頭から数えた位置</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="c1"># p13: 音節(Syllable)内の、末尾から数えた位置</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_backward</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="c1"># p14: 今が子音のときのみに定義される、直前の母音からの距離</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_from_previous_vowel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="c1"># p15: 今が子音のときのみに定義される、直後の母音までの距離</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_to_next_vowel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">'xx'</span>
        <span class="c1"># 未定義のコンテキスト</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undefined_context</span> <span class="o">=</span> <span class="s1">'xx'</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="si">}</span><span class="s1">'</span>

<div class="viewcode-block" id="Phoneme.is_vowel"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Phoneme.is_vowel">[docs]</a>    <span class="k">def</span> <span class="nf">is_vowel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        母音かどうか</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">==</span> <span class="s1">'v'</span></div>

<div class="viewcode-block" id="Phoneme.is_consonant"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Phoneme.is_consonant">[docs]</a>    <span class="k">def</span> <span class="nf">is_consonant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        子音かどうか</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">==</span> <span class="s1">'c'</span></div>

<div class="viewcode-block" id="Phoneme.is_rest"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Phoneme.is_rest">[docs]</a>    <span class="k">def</span> <span class="nf">is_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        休符かどうか</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'s'</span><span class="p">,</span> <span class="s1">'p'</span><span class="p">)</span></div>

<div class="viewcode-block" id="Phoneme.is_pau"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Phoneme.is_pau">[docs]</a>    <span class="k">def</span> <span class="nf">is_pau</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""休符かどうかを判定</span>

<span class="sd">        後方互換のために残した。</span>
<span class="sd">        'is_pau' is now 'is_rest'</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rest</span><span class="p">()</span></div>

<div class="viewcode-block" id="Phoneme.is_break"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.Phoneme.is_break">[docs]</a>    <span class="k">def</span> <span class="nf">is_break</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        息継ぎかどうか</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_independent_identity</span> <span class="o">==</span> <span class="s1">'b'</span></div></div>


<div class="viewcode-block" id="adjust_pau_contexts"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.adjust_pau_contexts">[docs]</a><span class="k">def</span> <span class="nf">adjust_pau_contexts</span><span class="p">(</span><span class="n">full_label</span><span class="p">:</span> <span class="n">HTSFullLabel</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HTSFullLabel</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    出力用に休符まわりの音節コンテキストを調整する。</span>
<span class="sd">    """</span>
    <span class="c1"># deepcopyが深く、できるだけSinsyの出力に近づける。でも遅い。</span>
    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
        <span class="n">new_label</span> <span class="o">=</span> <span class="n">HTSFullLabel</span><span class="p">()</span>
        <span class="c1"># NOTE: ここのdeepcopyめっちゃ遅い</span>
        <span class="n">new_label</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ol</span><span class="p">)</span> <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">full_label</span><span class="p">]</span>
        <span class="c1"># 前の音節とノートに関する処理</span>
        <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">new_label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">ol</span><span class="o">.</span><span class="n">previous_syllable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">identity</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'pau'</span><span class="p">,</span> <span class="s1">'sil'</span><span class="p">):</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">ol</span><span class="o">.</span><span class="n">previous_note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="c1"># 現在の音節とノートに関する処理</span>
        <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">new_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ol</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="c1"># 次の音節とノートに関する処理</span>
        <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">new_label</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ol</span><span class="o">.</span><span class="n">next_syllable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">identity</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'pau'</span><span class="p">,</span> <span class="s1">'sil'</span><span class="p">):</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">ol</span><span class="o">.</span><span class="n">next_note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>

    <span class="c1"># deepcopyが浅く処理が速い。ただし、Sinsyの出力と差異が生じてしまう。</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_label</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">full_label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">new_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ol</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">is_rest</span><span class="p">():</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">ol</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'xx'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>

    <span class="k">return</span> <span class="n">new_label</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../utaupy.html#utaupy.hts.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    直接実行された時にやるやつ</span>
<span class="sd">    """</span>
    <span class="n">path_hts_in</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'path_hts_in: '</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">path_hts_in</span><span class="p">)</span>
    <span class="n">label</span><span class="o">.</span><span class="n">song</span><span class="o">.</span><span class="n">autofill</span><span class="p">()</span>
    <span class="n">label</span><span class="o">.</span><span class="n">song</span><span class="o">.</span><span class="n">reset_time</span><span class="p">()</span>
    <span class="n">path_hts_out</span> <span class="o">=</span> <span class="n">path_hts_in</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.lab'</span><span class="p">,</span> <span class="s1">'_utaupy.lab'</span><span class="p">)</span>
    <span class="n">label</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path_hts_out</span><span class="p">,</span> <span class="n">strict_sinsy_style</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
      </article>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Author
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>